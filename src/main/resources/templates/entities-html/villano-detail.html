<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{fragments/head :: head ('Detalle de Villano')}"></head>
<body class="d-flex flex-column h-100 bg-light">

<header th:replace="~{fragments/header :: header}"></header>

<main class="container mt-5 mb-5" style="padding-top: 20px;">
    <!-- Tarjeta Principal del Villano -->
    <div class="card shadow mb-4">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h2 class="mb-0" th:text="${villano.alias}">Alias del Villano</h2>
            <span class="badge bg-warning text-dark">Villano</span>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h4 th:text="${villano.nombre}">Nombre Real</h4>
                    <p><strong>Email:</strong> <span th:text="${villano.email}">email@ejemplo.com</span></p>
                    <p><strong>Carnet de Villano:</strong> <span th:text="${villano.carnetDeVillano}">0000</span></p>

                    <div class="mt-3">
                        <a th:href="@{/villanos/{id}/edit(id=${villano.id})}" class="btn btn-primary">Editar Perfil</a>
                        <a th:href="@{/villanos}" class="btn btn-secondary">Volver a la lista</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid de Relaciones -->
    <div class="row">
        <!-- 1. Reservas -->
        <div class="col-md-12 mb-4">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">Reservas Realizadas</div>
                <div class="card-body">
                    <div th:if="${reservas.isEmpty()}" class="alert alert-info">Este villano no ha realizado reservas.</div>

                    <div th:unless="${reservas.isEmpty()}" class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Guarida</th>
                                <th>Entrada</th>
                                <th>Salida</th>
                                <th>Estado</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="reserva : ${reservas}">
                                <td th:text="${reserva.id}">1</td>
                                <!-- Verificación de null por seguridad -->
                                <td th:text="${reserva.guarida != null ? reserva.guarida.nombre : 'Guarida Eliminada'}">Nombre Guarida</td>
                                <td th:text="${reserva.fechaInicio}">2023-01-01</td>
                                <td th:text="${reserva.fechaFin}">2023-01-05</td>
                                <td>
                                    <span th:if="${reserva.estado}" class="badge bg-success">Confirmada</span>
                                    <span th:unless="${reserva.estado}" class="badge bg-warning text-dark">Pendiente</span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Reseñas (Comentarios Escritos) -->
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-success text-white">Historial de Reseñas</div>
                <div class="card-body">
                    <div th:if="${resenas.isEmpty()}" class="alert alert-info">No ha escrito reseñas.</div>
                    <ul th:unless="${resenas.isEmpty()}" class="list-group list-group-flush">
                        <li class="list-group-item" th:each="resena : ${resenas}">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1" th:text="${resena.guarida != null ? resena.guarida.nombre : 'Guarida desconocida'}">Lugar</h6>
                                <small class="text-warning" th:text="${resena.puntuacion} + ' ⭐'">5 ⭐</small>
                            </div>
                            <p class="mb-1 text-muted" th:text="'&quot;' + ${resena.comentario} + '&quot;'">Comentario</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 3. Facturas -->
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-secondary text-white">Facturas</div>
                <div class="card-body">
                    <div th:if="${facturas.isEmpty()}" class="alert alert-info">No tiene facturas registradas.</div>
                    <ul th:unless="${facturas.isEmpty()}" class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center" th:each="factura : ${facturas}">
                            <span>
                                <strong>Factura #<span th:text="${factura.id}">1</span></strong>
                                <br>
                                <small class="text-muted" th:text="${factura.fechaEmision}">2023-01-01</small>
                            </span>
                            <span class="badge bg-dark rounded-pill" th:text="${factura.total} + ' €'">100 €</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>