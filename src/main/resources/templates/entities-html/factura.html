<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{fragments/head :: head ('Facturas - BnBillains')}"></head>
<body class="d-flex flex-column h-100" style="background-color: #f8f9fa;">

<header th:replace="~{fragments/header :: header}"></header>

<main class="flex-shrink-0" style="margin-top: 50px; padding: 2rem;">
    <div class="container">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">Gesti√≥n de Facturas</h1>
        </div>

        <div class="card shadow-sm mb-4 border-0">
            <div class="card-body bg-white rounded">
                <form th:action="@{/facturas}" method="get" class="row g-3 align-items-end">

                    <div class="col-md-4">
                        <label class="form-label small text-muted fw-bold">M√©todo de Pago</label>
                        <select name="metodoPago" class="form-select">
                            <option value="">-- Todos --</option>
                            <option value="Pendiente" th:selected="${metodoPago == 'Pendiente'}">‚è≥ Pendiente</option>
                            <option value="Transferencia" th:selected="${metodoPago == 'Transferencia'}">üè¶ Transferencia</option>
                            <option value="Bitcoin" th:selected="${metodoPago == 'Bitcoin'}">‚Çø Bitcoin</option>
                            <option value="Oro" th:selected="${metodoPago == 'Oro'}">‚ö±Ô∏è Oro</option>
                            <option value="Efectivo" th:selected="${metodoPago == 'Efectivo'}">üíµ Efectivo</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label small text-muted fw-bold">Precio M√≠n (‚Ç¨)</label>
                        <input type="number" step="0.01" name="minImporte" class="form-control"
                               placeholder="0.00" th:value="${minImporte}">
                    </div>

                    <div class="col-md-3">
                        <label class="form-label small text-muted fw-bold">Precio M√°x (‚Ç¨)</label>
                        <input type="number" step="0.01" name="maxImporte" class="form-control"
                               placeholder="Max" th:value="${maxImporte}">
                    </div>

                    <div class="col-md-2 d-flex gap-2">
                        <button type="submit" class="btn btn-primary w-100 shadow-sm">
                            Filtrar
                        </button>
                        <a th:href="@{/facturas}" class="btn btn-outline-secondary shadow-sm" title="Borrar filtros">
                            ‚ùå
                        </a>
                    </div>

                    <input type="hidden" name="sort" th:value="${sort}">
                </form>
            </div>
        </div>

        <div class="table-responsive bg-white shadow rounded">
            <table class="table table-striped table-hover align-middle mb-0">
                <thead class="table-dark">
                <tr>
                    <th><a class="text-white text-decoration-none" th:href="@{/facturas(page=${currentPage}, sort='idDesc', metodoPago=${metodoPago}, minImporte=${minImporte}, maxImporte=${maxImporte})}">ID ‚Üï</a></th>
                    <th><a class="text-white text-decoration-none" th:href="@{/facturas(page=${currentPage}, sort='dateDesc', metodoPago=${metodoPago}, minImporte=${minImporte}, maxImporte=${maxImporte})}">Fecha ‚Üï</a></th>
                    <th class="text-end"><a class="text-white text-decoration-none" th:href="@{/facturas(page=${currentPage}, sort='amountDesc', metodoPago=${metodoPago}, minImporte=${minImporte}, maxImporte=${maxImporte})}">Importe ‚Üï</a></th>
                    <th class="text-end">Impuestos</th>
                    <th class="text-end fw-bold">TOTAL</th>
                    <th>M√©todo</th>
                    <th class="text-center">Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(facturas)}">
                    <td colspan="7" class="text-center p-5 text-muted">
                        <span class="fs-1">üßæ</span><br>No se encontraron facturas.
                    </td>
                </tr>
                <tr th:each="factura : ${facturas}">
                    <td th:text="${factura.id}">1</td>
                    <td th:text="${factura.fechaEmision}">01/01/2025</td>
                    <td class="text-end" th:text="${#numbers.formatDecimal(factura.importe, 1, 2)} + ' ‚Ç¨'">100.00 ‚Ç¨</td>
                    <td class="text-end text-danger" th:text="${#numbers.formatDecimal(factura.impuestosMalignos, 1, 2)} + ' ‚Ç¨'">21.00 ‚Ç¨</td>
                    <td class="text-end fw-bold text-success" th:text="${#numbers.formatDecimal(factura.importe + factura.impuestosMalignos, 1, 2)} + ' ‚Ç¨'">121.00 ‚Ç¨</td>
                    <td>
                        <span class="badge"
                              th:classappend="${factura.metodoPago == 'Pendiente'} ? 'bg-warning text-dark' : 'bg-secondary'"
                              th:text="${factura.metodoPago != null ? factura.metodoPago : 'N/A'}">Bitcoin</span>
                    </td>
                    <td class="text-center">
                        <div class="btn-group">
                            <a th:href="@{/facturas/{id}/edit(id=${factura.id})}" class="btn btn-sm btn-warning" title="Editar Pago">‚úèÔ∏è</a>
                            <a th:href="@{/facturas/{id}/verDetalle(id=${factura.id})}" class="btn btn-sm btn-info text-white" target="_blank" title="Ver PDF">üìÑ</a>
                            <a th:href="@{/facturas/delete/{id}(id=${factura.id})}" class="btn btn-sm btn-danger"
                               onclick="return confirm('¬øEliminar esta factura?');" title="Borrar">üóëÔ∏è</a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <nav th:if="${totalPages > 1}" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/facturas(page=${currentPage - 1}, sort=${sort}, metodoPago=${metodoPago}, minImporte=${minImporte}, maxImporte=${maxImporte})}">Anterior</a>
                </li>
                <li class="page-item disabled">
                    <span class="page-link" th:text="${currentPage} + ' / ' + ${totalPages}"></span>
                </li>
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{/facturas(page=${currentPage + 1}, sort=${sort}, metodoPago=${metodoPago}, minImporte=${minImporte}, maxImporte=${maxImporte})}">Siguiente</a>
                </li>
            </ul>
        </nav>

    </div>
</main>

<footer th:replace="~{fragments/footer :: footer}"></footer>

</body>
</html>